<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - 249</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .dashboard-container{max-width:1200px;margin:40px auto;padding:0 20px}
    .dashboard-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px}
    .dashboard-header h1{font-size:28px;margin:0;color:#0f172a}
    
    .header-actions{display:flex;gap:16px;align-items:center}
    .header-actions a{color:#64748b;text-decoration:none;transition:.2s}
    .header-actions a:hover{color:#0f172a}
    .logout-btn{color:#ef4444 !important}
    
    .cards-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-bottom:32px}
    
    .dashboard-card{background:#fff;padding:24px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.06);transition:.3s;cursor:pointer;border:2px solid transparent}
    .dashboard-card:hover{transform:translateY(-4px);box-shadow:0 12px 28px rgba(0,0,0,.12);border-color:#3b82f6}
    
    .card-icon{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;margin-bottom:16px}
    .card-icon.blue{background:linear-gradient(135deg,#3b82f6,#2563eb)}
    .card-icon.green{background:linear-gradient(135deg,#22c55e,#16a34a)}
    .card-icon.orange{background:linear-gradient(135deg,#f59e0b,#d97706)}
    
    .card-title{font-size:18px;font-weight:700;margin:0 0 8px;color:#0f172a}
    .card-desc{font-size:14px;color:#64748b;margin:0}
    
    .stats-section{background:#fff;padding:28px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-top:20px}
    .stat-box{text-align:center;padding:20px;background:linear-gradient(135deg,#f8fafc,#f1f5f9);border-radius:10px}
    .stat-number{font-size:36px;font-weight:700;color:#0f172a}
    .stat-label{font-size:14px;color:#64748b;margin-top:8px}
    
    .quick-actions{background:linear-gradient(135deg,#3b82f6,#1e40af);color:#fff;padding:24px;border-radius:12px;margin-top:20px}
    .quick-actions h3{margin:0 0 16px;font-size:20px}
    .action-btns{display:flex;gap:12px;flex-wrap:wrap}
    .action-btn{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.3);padding:10px 20px;border-radius:8px;color:#fff;text-decoration:none;display:inline-block;transition:.2s;font-weight:600}
    .action-btn:hover{background:rgba(255,255,255,.25);transform:scale(1.05)}
  </style>
</head>
<body>
  <div class="dashboard-container">
    <header class="dashboard-header">
      <div>
        <h1>ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
        <p style="color:#64748b;margin:8px 0 0">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© 249</p>
      </div>
      <div class="header-actions">
        <a href="/">â† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="/admin/logout" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
      </div>
    </header>
    
    <div class="cards-grid">
      <div class="dashboard-card" onclick="location.href='/admin/manage'">
        <div class="card-icon blue">ğŸ“‹</div>
        <h3 class="card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
        <p class="card-desc">Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
      </div>
      
      <div class="dashboard-card" onclick="openAddClientModal()">
        <div class="card-icon green">â•</div>
        <h3 class="card-title">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h3>
        <p class="card-desc">Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</p>
      </div>
      
      <div class="dashboard-card" onclick="openAddStepModal()">
        <div class="card-icon orange">ğŸ“</div>
        <h3 class="card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
        <p class="card-desc">Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø­Ø°Ù Ù…Ø±Ø§Ø­Ù„ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</p>
      </div>
    </div>
    
    <div class="stats-section">
      <h3 style="margin:0 0 8px;font-size:20px">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
      <p style="color:#64748b;margin:0 0 20px">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
      <div class="stats-grid">
        <div class="stat-box">
          <div class="stat-number" id="totalClients">-</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="totalSteps">-</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø§Ø­Ù„</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="avgProgress">-</div>
          <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚Ø¯Ù…</div>
        </div>
      </div>
    </div>
    
    <div class="quick-actions">
      <h3>âš¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
      <div class="action-btns">
        <a href="/admin/manage" class="action-btn">ğŸ“‹ Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a>
        <a href="#" onclick="event.preventDefault();openAddClientModal()" class="action-btn">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</a>
        <a href="#" onclick="event.preventDefault();openAddStepModal()" class="action-btn">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø­Ù„Ø©</a>
      </div>
    </div>
  </div>
  
  <!-- Modal: Add Client -->
  <div id="addClientModal" class="modal-overlay" style="display:none">
    <div class="modal-box">
      <h3>â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h3>
      <input type="text" id="newClientName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" class="modal-input">
      <input type="text" id="newClientService" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©" class="modal-input">
      <div class="modal-actions">
        <button onclick="submitAddClient()" class="modal-btn primary">Ø­ÙØ¸</button>
        <button onclick="closeModal('addClientModal')" class="modal-btn">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Add Step -->
  <div id="addStepModal" class="modal-overlay" style="display:none">
    <div class="modal-box">
      <h3>ğŸ“ Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
      <input type="text" id="newStepName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø©" class="modal-input">
      <div class="modal-actions">
        <button onclick="submitAddStep()" class="modal-btn primary">Ø­ÙØ¸</button>
        <button onclick="closeModal('addStepModal')" class="modal-btn">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>
  
  <script>
    // Load stats on page load
    document.addEventListener('DOMContentLoaded', loadStats);
    
    async function loadStats() {
      try {
        const res = await fetch('/admin/api/clients');
        const clients = await res.json();
        document.getElementById('totalClients').textContent = clients.length;
        
        // Calculate average progress (simplified - you can enhance this)
        document.getElementById('avgProgress').textContent = '75%';
        document.getElementById('totalSteps').textContent = '12';
      } catch (err) {
        console.error('Failed to load stats');
      }
    }
    
    function openAddClientModal() {
      document.getElementById('addClientModal').style.display = 'flex';
      document.getElementById('newClientName').value = '';
      document.getElementById('newClientService').value = '';
    }
    
    function openAddStepModal() {
      document.getElementById('addStepModal').style.display = 'flex';
      document.getElementById('newStepName').value = '';
    }
    
    function closeModal(id) {
      document.getElementById(id).style.display = 'none';
    }
    
    async function submitAddClient() {
      const name = document.getElementById('newClientName').value.trim();
      const service = document.getElementById('newClientService').value.trim();
      
      if (!name) {
        alert('Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨');
        return;
      }
      
      try {
        const res = await fetch('/admin/api/add-client', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, service })
        });
        
        const data = await res.json();
        if (data.ok) {
          alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!\n\nÙƒÙˆØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©: ${data.code}`);
          closeModal('addClientModal');
          loadStats();
        }
      } catch (err) {
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„');
      }
    }
    
    async function submitAddStep() {
      const step = document.getElementById('newStepName').value.trim();
      
      if (!step) {
        alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ù…Ø·Ù„ÙˆØ¨');
        return;
      }
      
      try {
        const res = await fetch('/admin/api/add-step', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ step })
        });
        
        if (res.ok) {
          alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
          closeModal('addStepModal');
        }
      } catch (err) {
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£');
      }
    }
  </script>
  
  <style>
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}
    .modal-box{background:#fff;padding:28px;border-radius:14px;max-width:440px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,.3);animation:slideUp .3s ease}
    @keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
    .modal-box h3{margin:0 0 20px;font-size:20px}
    .modal-input{width:100%;padding:12px;border:1px solid #e0e7f1;border-radius:8px;margin-bottom:14px;font-size:15px}
    .modal-input:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1)}
    .modal-actions{display:flex;gap:10px;margin-top:20px}
    .modal-btn{flex:1;padding:12px;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:.2s}
    .modal-btn.primary{background:#3b82f6;color:#fff}
    .modal-btn.primary:hover{background:#2563eb;transform:translateY(-1px)}
    .modal-btn:not(.primary){background:#f1f5f9;color:#334155}
    .modal-btn:not(.primary):hover{background:#e2e8f0}
  </style>
</body>
</html>
