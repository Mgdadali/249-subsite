<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>249 | متابعة الطلب</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <!-- شعار الشركة -->
    <img src="https://i.ibb.co/7JN5w2K3/logo-removebg-preview-1.png" alt="249 Logo" class="logo">

    <h1>متابعة سير الطلبات</h1>
    <p>من فضلك أدخل كود المتابعة:</p>

    <input type="text" id="code" placeholder="كود المتابعة">
    <button onclick="track()">متابعة الطلب</button>

    <div id="result"></div>
</div>

<script>
function track() {
    const code = document.getElementById("code").value.trim().toUpperCase();
    const result = document.getElementById("result");

    if (!code) {
        alert("من فضلك أدخل كود المتابعة");
        return;
    }

    result.innerHTML = "جاري البحث...";

    fetch(`/track?code=${code}`)
        .then(res => res.json())
        .then(data => {
            if (data.error) {
                result.innerHTML = `<strong>${data.error}</strong>`;
                return;
            }

            // تحديد لون الشريط حسب الحالة
            let progressColor = (data.status.toLowerCase() === "مكتمل" || data.status.toLowerCase() === "complete") ? "#28a745" : "#1e90ff";

            result.innerHTML = `
                <div class="card">
                    <p><strong>الاسم:</strong> ${data.name}</p>
                    <p><strong>الخدمة:</strong> ${data.service}</p>
                    <p><strong>الحالة:</strong> ${data.status}</p>
                    <p><strong>المرحلة الحالية:</strong> ${data.step}</p>
                    
                    <div class="progress">
                        <div class="progress-bar" style="width:${getProgress(data.status)}%; background-color:${progressColor};"></div>
                    </div>

                    <p><strong>ملاحظات:</strong> ${data.notes}</p>
                    <p class="date"><strong>آخر تحديث:</strong> ${data.last_update}</p>
                </div>
            `;
        })
        .catch(() => { result.innerHTML = "حدث خطأ في الاتصال بالخادم"; });
}

function getProgress(status){
    const map = {
        "مستلم": 50,
        "قيد الإجراء": 50,
        "تم التقديم": 50,
        "بانتظار الرد": 50,
        "مكتمل": 100,
        "complete": 100
    };
    return map[status] || 50;
}
</script>
</body>
</html>
